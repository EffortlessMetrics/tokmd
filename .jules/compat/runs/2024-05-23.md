# Run 2024-05-23: Compat Scout (Amended)

## Discovery
Found that `tokmd` CLI crate forced `git`, `walk`, `content` features on `tokmd-analysis` and `tokmd-git`.
This prevents building a lightweight binary.
Also encountered `Rustfmt` CI failures due to pre-existing formatting violations.

## Decision
Option A: Refactor `Cargo.toml` to expose these as features.
Option B: Fix formatting to pass CI.

## Changes
- `crates/tokmd/Cargo.toml`: Added `[features]`.
- `crates/tokmd/src/commands/diff.rs`: Gated git usage.
- `crates/tokmd/tests/run_diff.rs`: Gated git tests.
- Formatting fixes applied to `crates/tokmd/src/commands/context.rs`, `crates/tokmd/src/context_pack.rs`, `crates/tokmd-analysis-format/src/lib.rs`, and `crates/tokmd-format/src/lib.rs`.

## Verification
- `cargo check --package tokmd --no-default-features` passed.
- `cargo test --package tokmd --no-default-features` passed.
- `cargo fmt -- --check` passed.
