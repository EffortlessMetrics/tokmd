# Run: 2026-02-03-gatekeeper-config-toml-determinism

**Goal**: Maximize SRP-quality improvement per reviewer minute.
**Lane**: Scout discovery.

## Findings
Discovered that `TomlConfig.view` was using `HashMap<String, ViewProfile>`. This violates the `CLAUDE.md` directive for "Deterministic Output" ("Uses `BTreeMap` instead of `HashMap` everywhere for stable key ordering"). While currently potentially harmless if only used for lookup, serialization of this config (e.g. for debugging or re-exporting) would be non-deterministic.

## Decision
Option A: Replace `HashMap` with `BTreeMap` in `TomlConfig` and add a regression test.
- Ensures lexicographical ordering of keys in serialization.
- Improves compliance with project standards.

## Changes
- Modified `crates/tokmd-config/src/lib.rs`: Changed `HashMap` to `BTreeMap` for `TomlConfig.view`.
- Added `crates/tokmd-config/tests/determinism.rs`: Added `test_toml_config_determinism` to verify serialization order.

## Verification
- `test_toml_config_determinism` failed with `HashMap` (proving the issue/need).
- `test_toml_config_determinism` passed with `BTreeMap`.
- `cargo test -p tokmd-config` passed (no regressions).
