# Palette Run 2026-02-24

**Run ID**: 20260224-132200
**Lane**: Scout
**Target**: `tokmd context` budget packing logic

## Discovery
Found that `tokmd context` over-packs files when they exceed the per-file budget cap.
- `select_files_with_options` caps the token count for accounting.
- `write_head_tail` uses the capped count to calculate density (`tpl`), which is incorrect.
- Result: Full file is included instead of a truncated version.

## Options Considered

### Option A (Fix accounting)
Pass original token counts to `ContextFileRow` or `write_head_tail`. Use original counts for density calculation.
- Trade-off: Requires modifying `context_pack.rs`.

### Option B (Fix capping)
Actually truncate the file content in memory before packing? No, we stream/write directly.

## Decision
Option A. It's the correct fix. We need to preserve the truth about the file size.

## Receipts
