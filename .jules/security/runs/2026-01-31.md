# Sentinel Run 2026-01-31

**Run ID**: `2026-01-31-sentinel-run-01`
**Lane**: Scout
**Target**: `crates/tokmd/src/commands/cockpit.rs`

## Findings
During a scan for `unwrap()` usage in production code (`crates/tokmd/src/`), I found several instances in `compute_diff_coverage_gate` within `crates/tokmd/src/commands/cockpit.rs`.

Specifically:
1. `lcov_data.entry(current_file.clone().unwrap()).or_default();` - Unnecessary clone and unwrap.
2. `lcov_data.get_mut(file).unwrap().insert(line_no, count);` - Relies on implicit state invariant established by `SF:` line processing.

While these are likely safe given correct LCOV format processing, they represent code smells and potential panic points if logic drifts or LCOV is malformed in unexpected ways.

## Options Considered
### Option A (Selected)
Refactor the parsing logic to be panic-free.
- Use `normalized.clone()` directly when setting `current_file`.
- Use `if let Some(entry) = lcov_data.get_mut(file)` to handle insertion safely.

### Option B
Replace `unwrap()` with `expect("invariant violated")`.
- Better than `unwrap()`, but still panics.
- Doesn't improve robustness against malformed input.

## Decision
Proceed with **Option A** to burn down `unwrap()` usage and improve robustness.

## Verification
Will run `cargo test -p tokmd --features git` to ensure no regression.
Will also add a test case for malformed LCOV if feasible, or at least verify existing tests cover this path.

## Verification Results
- `cargo test -p tokmd --lib commands::cockpit --features git`: PASS
- `cargo fmt`: PASS (applied formatting fixes)
- `cargo clippy`: PASS (fixed collapsible_if warnings)
