# Security Run 2025-02-24

**Lane:** Scout
**Target:** Redaction Leak in `tokmd run` (module.json)

## ðŸŽ¯ Findings
`tokmd run --redact all` correctly redacts `export.jsonl` but fails to redact `module.json`.
The `ModuleReport` contains `module` fields which are directory paths (e.g., `crates/tokmd`). These are currently written in plain text even when redaction is requested.

## ðŸ§­ Options Considered

### Option A: Fix in `tokmd-format` (Recommended)
- Modify `write_module_json_to_file` to accept `RedactMode`.
- Implement `redact_module_report` helper in `tokmd-format`.
- Update `tokmd run` to pass the flag.
- **Trade-offs:** Changes public API of `tokmd-format` (helper function), but isolates formatting logic where it belongs.

### Option B: Fix in `tokmd-model`
- Add redaction support to `create_module_report`.
- **Trade-offs:** Pollutes "pure" model logic with formatting/redaction concerns. `tokmd-model` shouldn't depend on redaction rules.

## âœ… Decision
Option A. Redaction is a formatting/output concern.

## ðŸ§± Changes
- `crates/tokmd-format/src/lib.rs`: Add redaction logic for `ModuleReport`.
- `crates/tokmd/src/commands/run.rs`: Pass `redact_mode` to writer.
