# Run Log: 2026-01-28

## Context
Read CI config, CLAUDE.md, CONTRIBUTING.md, and README.md.
Repo follows a tiered microcrate architecture.
Performance is a key concern (tokei wrapper).

## Selected Lane
Scout Discovery

## Target
Allocation in `redact_rows` (crates/tokmd-format/src/lib.rs).
It allocates a full `Vec<FileRow>` copy of the dataset even when no redaction is needed, and performs O(N) allocations for strings.

## Proof
Structural proof:
- Before: `redact_rows` allocates `Vec<FileRow>`, cloning every row.
- After: Iterator-based streaming (`Cow<FileRow>` wrapper) with zero allocation for pass-through and minimal allocation for redaction.

## Options Considered
### Option A (Selected)
Refactor `redact_rows` to return an iterator of `RedactedRow<'a>` which implements `Serialize`.
This fits the repo because `FileRow` is the main data structure exported, and avoiding N copies is a significant win for large repos.

### Option B
Use a custom `Serializer` for the whole `ExportData`. Too complex given `serde` derives exist.

## Receipts
Replaced redact_rows with streaming iterator. Tests pass. Clippy passes.

## Outcome
Superseded. The export serialization streaming optimization will be considered in a future PR. Stopping work.
