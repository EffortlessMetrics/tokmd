# Run 2026-02-24

## Bootstrap
- Read: `CI`, `AGENTS.md`
- Gates: `cargo build`, `cargo test`, `cargo fmt`, `cargo clippy`

## Selection
- Lane: Scout
- Target: `crates/tokmd-cockpit/src/determinism.rs`

## Decision
- Options:
  - Option A: Switch `hash_files_from_paths` and `hash_files_from_walk` to use streaming hashing (`std::io::copy`).
    - Pros: Reduces memory usage from O(file_size) to O(buffer_size). Prevents OOM on large files.
    - Cons: Slightly more complex error handling.
  - Option B: Keep loading full file content into `Vec<u8>`.
    - Pros: Simpler code.
    - Cons: High memory usage.
- Selected: Option A.

## Proof
- Method: Structural (remove `std::fs::read` allocation).
- Results: Replaced `std::fs::read` with `std::fs::File::open` and `std::io::copy`.
  - Baseline (50MB): ~75ms, Hash: `665fb3681f661217af44e5aed5f3305119db25cd54b472eebddbcd2f7a6ced09`
  - After (50MB): ~96ms, Hash: `665fb3681f661217af44e5aed5f3305119db25cd54b472eebddbcd2f7a6ced09`
  - Difference: 20ms slower (acceptable for O(1) memory).

## Receipts
- `cargo test -p tokmd-cockpit --test bench_hash`: PASS (baseline & after)
- `cargo test -p tokmd-cockpit`: PASS
- `cargo fmt`: PASS
- `cargo clippy`: PASS
