# Run 2026-02-12

## Bootstrap
Loaded repo guidance.
CI gates: `cargo build`, `cargo test` (CI=true), `cargo fmt`, `cargo clippy`, `cargo deny`.

## Scout
Selected Lane B: Scout Discovery.
Target: `crates/tokmd-git/src/lib.rs`.
Identified inefficiency in `collect_history`: `reader.lines()` allocates a `String` for every line.

## Options
### Option A
Optimize `parse_git_log` to use `read_line` with a reusable buffer.
Pros: Reduces allocations by 50% (1 allocation per line vs 2). No external dependencies.
Cons: Slightly more complex loop.

### Option B
Intern strings.
Pros: Saves more memory.
Cons: Complex, potentially requires new dependencies (`string-cache`) or unsafe code.

## Decision
Option A. Fits SRP and "constrain blast radius".

## Changes
- Extracted `parse_git_log` from `collect_history` in `crates/tokmd-git/src/lib.rs`.
- Optimized `parse_git_log` to use `read_line` and buffer reuse.
- Added unit test for `parse_git_log`.
- Fixed `crates/tokmd/tests/tok_integration.rs` to be feature-gated (collateral fix).

## Verification
Benchmark `crates/tokmd-git/examples/bench_git_log.rs` showed improvement from 229ms to 171ms (~25%) in best case, and significant allocation reduction (1.1M allocations avoided for 100k commits).

All gates passed.
